if(!Array.prototype.reduce){Array.prototype.reduce=function(a){var b=this.length;if(typeof a!="function")throw new TypeError();if(b==0&&arguments.length==1)throw new TypeError();var c=0;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c++];break}if(++c>=b)throw new TypeError();}while(true)}for(;c<b;c++){if(c in this)d=a.call(null,d,this[c],c,this)}return d}};var UniqueNumList=function(a,b){if(Number(b)>0&&jQuery.inArray(b,a)<0)a.push(b);return a};function CollapsibleList(d,e){var f=/^page-list-(\d+)$/;this.container=jQuery(d);this.root_id=parseInt(this.container.attr('id').replace(f,'$1'));this.main=jQuery(d.children('p')[0]);this.list=jQuery(d.children('ol')[0]);this.toggle=function(){if(this.container.hasClass('collapsed')){this.expand()}else{this.collapse()}};this.collapse=function(){this.list.slideUp(150);this.toggler.addClass('collapsed-toggle');this.container.addClass('collapsed');e.addPage(this.root_id)};this.expand=function(){this.list.slideDown(150);this.toggler.removeClass('collapsed-toggle');this.container.removeClass('collapsed');e.removePage(this.root_id)};this.addToggle=function(b){var c=this;this.toggler=jQuery(b);if(this.container.hasClass('collapsed'))this.toggler.addClass('collapsed-toggle');this.main.prepend(this.toggler);this.toggler.bind('click',function(a){c.toggle()})}};function CollapsedPageSet(c){this.pages=[];this.retrieve=function(){this.pages=jQuery(c).val().split(',').reduce(UniqueNumList,[])};this.save=function(){this.pages=this.pages.reduce(UniqueNumList,[]);jQuery(c).val(this.pages.join(','))};this.addPage=function(a){this.retrieve();if(this.pages instanceof Array){this.pages.push(a)}else{this.pages=[a]}this.save()};this.removePage=function(b){this.retrieve();if(this.pages instanceof Array){this.pages=jQuery.grep(this.pages,function(a){return a!=b})}else{this.pages=[]}this.save()}};jQuery(document).ready(function(){jQuery('#navbar-select').addClass('js');var b=new CollapsedPageSet('#opt-collapsed-pages');jQuery('#navbar-select ol').each(function(a){list=new CollapsibleList(jQuery(this).parent(),b);list.addToggle('<span class="toggle">Toggle</span>')})});